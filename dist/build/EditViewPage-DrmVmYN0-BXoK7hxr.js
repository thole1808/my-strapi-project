import{av as O,aK as Q,u as k,h as q,ds as z,r as G,dy as Y,dm as H,j as s,P as o,bX as K,$ as U,fl as X,d2 as d,fm as h,Q as f,fn as _,fo as $,fp as S,c3 as J,m as W,dj as Z,dk as ss,d as ts,fq as es}from"./strapi-BdxGaNQU.js";import{a as as,F as P}from"./Input-CZ1YvjHR-D-drVieF.js";import"./usePrev-CZGy2Vjf-WLgvVAR-.js";import"./useDragAndDrop-DJ6jqvZN-N0gyU3Rl.js";import"./objects-D6yBsdmx-mVP92-uR.js";import"./Relations-C2Ahkrdg-DWO_old2.js";import"./relations-BakOFl_1-jC5g2PF2.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-BHaZaerr.js";const is=t=>G.useEffect(t,ns),ns=[],rs=()=>{const t=O(),[{query:{status:a}},i]=Q({status:"draft"}),{formatMessage:n}=k(),{toggleNotification:r}=q(),{document:x,meta:c,isLoading:T,schema:l,components:j,collectionType:v,id:C,model:D,hasError:I,getTitle:b,getInitialFormValues:R}=z(),u=l?.options?.draftAndPublish??!1;is(()=>{t?.state&&"error"in t.state&&r({type:"danger",message:t.state.error,timeout:5e3})});const A=Y("EditViewPage",e=>e.isLoading),m=!C&&!(v===es),{isLoading:F,edit:{layout:y,settings:{mainField:L}}}=H(D),{isLazyLoading:V}=as([]),M=A||T||F||V,p=R(m);if(I)return s.jsx(o.Error,{});if(M&&!x?.documentId)return s.jsx(o.Loading,{});if(!p)return s.jsx(o.Error,{});const B=e=>{(e==="published"||e==="draft")&&i({status:e},"push",!0)},N=(e,g)=>S(l?.attributes,j,{status:a,...g}).validateSync(e,{abortEarly:!1});return s.jsxs(K,{paddingLeft:10,paddingRight:10,children:[s.jsx(o.Title,{children:b(L)}),s.jsx(U,{disabled:u&&a==="published",initialValues:p,method:m?"POST":"PUT",validate:(e,g)=>S(l?.attributes,j,{status:a,...g}).validate(e,{abortEarly:!1}),initialErrors:t?.state?.forceValidation?N(p,{}):{},children:({resetForm:e})=>s.jsxs(s.Fragment,{children:[s.jsx(X,{isCreating:m,status:u?os(x,c):void 0,title:b(L)}),s.jsxs(d.Root,{variant:"simple",value:a,onValueChange:B,children:[s.jsx(d.List,{"aria-label":n({id:h("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:u?s.jsxs(s.Fragment,{children:[s.jsx(E,{value:"draft",children:n({id:h("containers.edit.tabs.draft"),defaultMessage:"draft"})}),s.jsx(E,{disabled:!c||c.availableStatus.length===0,value:"published",children:n({id:h("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),s.jsxs(f.Root,{paddingTop:8,gap:4,children:[s.jsxs(f.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[s.jsx(d.Content,{value:"draft",children:s.jsx(P,{layout:y})}),s.jsx(d.Content,{value:"published",children:s.jsx(P,{layout:y})})]}),s.jsx(f.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:s.jsx(_,{})})]})]}),s.jsx($,{onProceed:e})]})})]})},E=ts(d.Trigger)`
  text-transform: uppercase;
`,os=(t,a)=>{const i=t?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(r=>r.publishedAt!==null)?"published":i:"draft"},js=()=>{const{slug:t=""}=J(),{permissions:a=[],isLoading:i,error:n}=W(Z.map(r=>({action:r,subject:t})));return i?s.jsx(o.Loading,{}):n||!t?s.jsx(o.Error,{}):s.jsx(o.Protect,{permissions:a,children:({permissions:r})=>s.jsx(ss,{permissions:r,children:s.jsx(rs,{})})})};export{rs as EditViewPage,js as ProtectedEditViewPage,os as getDocumentStatus};
